replicaCount: 1
mode: statefulSet

rbac:
  create: true

statefulSet:
  clusterMode: false
  replicationFactor: 1

nameOverride: vmagent
fullnameOverride: vmagent

annotations:
  configmap.reloader.stakater.com/reload: vmagent-config

extraArgs:
  envflag.enable: true
  envflag.prefix: VM_
  loggerFormat: json
  httpListenAddr: :8429
  graphiteListenAddr: ":2003"
  # promscrape.cluster.memberLabel: vmagent_instance

resources:
  limits:
    cpu: 100m
  requests:
    cpu: 20m
    memory: 100Mi

extraVolumeMounts:
- name: etcd-tls-volume
  mountPath: /tls/etcd-tls
- name: kubernetes-scrape-config
  mountPath: /configs

extraVolumes:
- name: etcd-tls-volume
  secret:
    secretName: etcd-secrets
- name: kubernetes-scrape-config
  configMap:
    name: kubernetes-scrape-config

remoteWrite:
- url: "http://vmsingle.monitoring.svc.cluster.local.:8428/api/v1/write"

service:
  enabled: true
  annotations:
    prometheus.io/scrape: "true"
    prometheus.io/port: "8429"

ingress:
  enabled: true
  annotations:
    cert-manager.io/cluster-issuer: ca-issuer
  hosts:
  - name: vmagent.dev.local
    path: /
    port: http
  tls:
  - secretName: vmagent-tls
    hosts:
    - vmagent.dev.local

affinity:
  podAntiAffinity:
    requiredDuringSchedulingIgnoredDuringExecution:
    - labelSelector:
        matchExpressions:
        - key: app
          operator: In
          values: [ vmagent ]
      topologyKey: kubernetes.io/hostname

persistence:
  enabled: true
  size: 1Gi
  storageClassName: local-path

config:
  global:
    scrape_interval: 15s
  scrape_configs:
  scrape_config_files:
  - /configs/*.yaml
